{
  "version": "0.1",
  "module": "schema_module",
  "declarations": {
    "cube": {
      "name": "cube",
      "parameters": [{"kind":"input","path":["cube"]}],
      "operations": [{"id":0,"op":"LoadInput","args":[["cube"]],"stamp":{"dtype":"array","axes":["cube"]}}],
      "result": 0
    },
    "layer": {
      "name": "layer",
      "parameters": [{"kind":"input","path":["cube","layer"]}],
      "operations": [{"id":0,"op":"LoadInput","args":[["cube","layer"]],"stamp":{"dtype":"array","axes":["cube","layer"]}}],
      "result": 0
    },
    "row": {
      "name": "row",
      "parameters": [{"kind":"input","path":["cube","layer","row"]}],
      "operations": [{"id":0,"op":"LoadInput","args":[["cube","layer","row"]],"stamp":{"dtype":"array","axes":["cube","layer","row"]}}],
      "result": 0
    },
    "cell": {
      "name": "cell",
      "parameters": [{"kind":"input","path":["cube","layer","row","cell"]}],
      "operations": [
        {
          "id": 0,
          "op": "LoadInput",
          "args": [["cube","layer","row","cell"]],
          "stamp": {"dtype":"integer","axes":["cube","layer","row"]}
        }
      ],
      "result": 0
    },
    "cell_over_limit": {
      "name": "cell_over_limit",
      "parameters": [{"kind":"input","path":["cube","layer","row","cell"]}],
      "operations": [
        {
          "id": 0,
          "op": "LoadInput",
          "args": [["cube","layer","row","cell"]],
          "stamp": {"dtype":"integer","axes":["cube","layer","row"]}
        },
        {"id":1,"op":"Const","args":[100],"stamp":{"dtype":"integer","axes":[]}},
        {"id":2,"op":"Map","args":[0,1],"stamp":{"dtype":"boolean","axes":["cube","layer","row"]},"attrs":{"fn":"core.gt"}}
      ],
      "result": 2
    },
    "cell_sum": {
      "name": "cell_sum",
      "parameters": [{"kind":"input","path":["cube","layer","row","cell"]},{"kind":"dependency","source":"cell_over_limit"}],
      "operations": [
        {"id":0,"op":"LoadDeclaration","args":["cell_over_limit"],"stamp":{"dtype":"boolean","axes":["cube","layer","row"]}},
        {
          "id": 1,
          "op": "LoadInput",
          "args": [["cube","layer","row","cell"]],
          "stamp": {"dtype":"integer","axes":["cube","layer","row"]}
        },
        {"id":2,"op":"Const","args":[0],"stamp":{"dtype":"integer","axes":[]}},
        {"id":3,"op":"Select","args":[0,1,2],"stamp":{"dtype":"integer","axes":["cube","layer","row"]}},
        {
          "id": 4,
          "op": "Reduce",
          "args": [3],
          "stamp": {"dtype":"integer","axes":["cube","layer"]},
          "attrs": {"fn":"agg.sum","axis":"row"}
        }
      ],
      "result": 4
    },
    "count_over_limit": {
      "name": "count_over_limit",
      "parameters": [{"kind":"dependency","source":"cell_over_limit"}],
      "operations": [
        {"id":0,"op":"LoadDeclaration","args":["cell_over_limit"],"stamp":{"dtype":"boolean","axes":["cube","layer","row"]}},
        {"id":1,"op":"Const","args":[1],"stamp":{"dtype":"integer","axes":[]}},
        {"id":2,"op":"Const","args":[0],"stamp":{"dtype":"integer","axes":[]}},
        {"id":3,"op":"Select","args":[0,1,2],"stamp":{"dtype":"integer","axes":["cube","layer","row"]}},
        {
          "id": 4,
          "op": "Reduce",
          "args": [3],
          "stamp": {"dtype":"integer","axes":["cube","layer"]},
          "attrs": {"fn":"agg.sum","axis":"row"}
        },
        {"id":5,"op":"Reduce","args":[4],"stamp":{"dtype":"integer","axes":["cube"]},"attrs":{"fn":"agg.sum","axis":"layer"}},
        {"id":6,"op":"Reduce","args":[5],"stamp":{"dtype":"integer","axes":[]},"attrs":{"fn":"agg.sum","axis":"cube"}}
      ],
      "result": 6
    }
  },
  "analysis": {
    "defaults": {"key_policy":"indifferent","on_missing":"error"},
    "inputs": [
      {
        "path": ["cube"],
        "axes": ["cube"],
        "dtype": "array",
        "key_policy": "indifferent",
        "on_missing": "error",
        "axis_loops": [{"axes":"cube","path":["cube"],"loop_idx":0,"kind":"array_field","key":"cube"}],
        "leaf_nav": [],
        "terminal": {"kind":"none","dtype":"array","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "cube"
      },
      {
        "path": ["cube","layer"],
        "axes": ["cube","layer"],
        "dtype": "array",
        "key_policy": "indifferent",
        "on_missing": "error",
        "axis_loops": [
          {"axes":"cube","path":["cube"],"loop_idx":0,"kind":"array_field","key":"cube"},
          {"axes":"layer","path":["cube","layer"],"loop_idx":1,"kind":"array_element","alias":"layer"}
        ],
        "leaf_nav": [],
        "terminal": {"kind":"none","dtype":"array","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "cube.layer"
      },
      {
        "path": ["cube","layer","row"],
        "axes": ["cube","layer","row"],
        "dtype": "array",
        "key_policy": "indifferent",
        "on_missing": "error",
        "axis_loops": [
          {"axes":"cube","path":["cube"],"loop_idx":0,"kind":"array_field","key":"cube"},
          {"axes":"layer","path":["cube","layer"],"loop_idx":1,"kind":"array_element","alias":"layer"},
          {"axes":"row","path":["cube","layer","row"],"loop_idx":2,"kind":"array_element","alias":"row"}
        ],
        "leaf_nav": [],
        "terminal": {"kind":"none","dtype":"array","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "cube.layer.row"
      },
      {
        "path": ["cube","layer","row","cell"],
        "axes": ["cube","layer","row"],
        "dtype": "integer",
        "key_policy": "indifferent",
        "on_missing": "error",
        "axis_loops": [
          {"axes":"cube","path":["cube"],"loop_idx":0,"kind":"array_field","key":"cube"},
          {"axes":"layer","path":["cube","layer"],"loop_idx":1,"kind":"array_element","alias":"layer"},
          {"axes":"row","path":["cube","layer","row"],"loop_idx":2,"kind":"array_element","alias":"row"}
        ],
        "leaf_nav": [],
        "terminal": {"kind":"element_leaf","dtype":"integer","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "cube.layer.row.cell"
      }
    ]
  }
}