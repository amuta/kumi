(SNAST
  (VALUE total_payroll
    (Reduce :agg.sum over [employees]
      (InputRef departments.dept.employees.emp.salary key_chain=[salary]) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE manager_count
    (Reduce :agg.sum over [employees]
      (Select
        (Call :core.eq
          (InputRef departments.dept.employees.emp.role key_chain=[role]) :: [departments, employees] -> string
          (Const "manager") :: [] -> string
        ) :: [departments, employees] -> boolean
        (Const 1) :: [] -> integer
        (Const 0) :: [] -> integer
      ) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE senior_employee_count
    (Reduce :agg.sum over [employees]
      (Select
        (Call :core.eq
          (InputRef departments.dept.employees.emp.role key_chain=[role]) :: [departments, employees] -> string
          (Const "senior") :: [] -> string
        ) :: [departments, employees] -> boolean
        (Const 1) :: [] -> integer
        (Const 0) :: [] -> integer
      ) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE max_salary
    (Reduce :agg.max over [employees]
      (InputRef departments.dept.employees.emp.salary key_chain=[salary]) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE department_summary
    (Hash
      (Pair name
        (InputRef departments.dept.name key_chain=[name]) :: [departments] -> string
      ) :: [departments] -> pair
      (Pair total_payroll
        (Ref total_payroll) :: [departments] -> integer
      ) :: [departments] -> pair
      (Pair manager_count
        (Ref manager_count) :: [departments] -> integer
      ) :: [departments] -> pair
      (Pair senior_count
        (Ref senior_employee_count) :: [departments] -> integer
      ) :: [departments] -> pair
      (Pair top_salary
        (Ref max_salary) :: [departments] -> integer
      ) :: [departments] -> pair
    ) :: [departments] -> hash
  ) :: [departments] -> hash
)