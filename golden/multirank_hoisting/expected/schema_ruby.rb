# Autogenerated by Kumi Codegen
module Kumi::Compiled::KUMI_9a37856ac6ad5b4760bc2a1153db17b783c7519ab8eb01a2d993361a72bf68df
  def self.from(input_data = nil)
    instance = Object.new
    instance.extend(self)
    instance.instance_variable_set(:@input, input_data)
    instance
  end

  def self.__kumi_executable__
    instance = Object.new
    instance.extend(self)
    instance
  end

  def update(input_data)
    @input = @input.merge(input_data)
    self
  end

  def [](name)
    case name
    when :global_offset_plus then _global_offset_plus
    when :batch_bias then _batch_bias
    when :row_scale2 then _row_scale2
    when :elem_affine then _elem_affine
    when :row_sum_affine then _row_sum_affine
    when :batch_total_affine then _batch_total_affine
    else raise KeyError, "Unknown declaration"
    end
  end

  def _global_offset_plus(input = @input)
    t1 = input["global_offset"] || input[:global_offset]
    t2 = 1.0
    t1 + t2
  end

  def _batch_bias(input = @input)
    out = []
    t4 = input["batch"] || input[:batch]
    t54 = input["global_offset"] || input[:global_offset]
    t55 = 1.0
    t56 = t54 + t55
    t4.each_with_index do |batch_el_5, batch_i_6|
      t7 = batch_el_5["mean"] || batch_el_5[:mean]
      t9 = t7 + t56
      out << t9
    end
    out
  end

  def _row_scale2(input = @input)
    out = []
    t10 = input["batch"] || input[:batch]
    t17 = 2.0
    t10.each_with_index do |batch_el_11, batch_i_12|
      out_1 = []
      t13 = batch_el_11["row"] || batch_el_11[:row]
      t13.each_with_index do |row_el_14, row_i_15|
        t16 = row_el_14["scale"] || row_el_14[:scale]
        t18 = t16 * t17
        out_1 << t18
      end
      out << out_1
    end
    out
  end

  def _elem_affine(input = @input)
    out = []
    t19 = input["batch"] || input[:batch]
    t81 = input["global_offset"] || input[:global_offset]
    t82 = 1.0
    t60 = 2.0
    t83 = t81 + t82
    t19.each_with_index do |batch_el_20, batch_i_21|
      out_1 = []
      t22 = batch_el_20["row"] || batch_el_20[:row]
      t64 = batch_el_20["mean"] || batch_el_20[:mean]
      t65 = t64 + t83
      t22.each_with_index do |row_el_23, row_i_24|
        out_2 = []
        t25 = row_el_23["col"] || row_el_23[:col]
        t59 = row_el_23["scale"] || row_el_23[:scale]
        t61 = t59 * t60
        t25.each_with_index do |col_el_26, col_i_27|
          t28 = col_el_26["val"] || col_el_26[:val]
          t30 = t28 * t61
          t32 = t30 + t65
          out_2 << t32
        end
        out_1 << out_2
      end
      out << out_1
    end
    out
  end

  def _row_sum_affine(input = @input)
    out = []
    t33 = input["batch"] || input[:batch]
    t87 = 2.0
    t90 = input["global_offset"] || input[:global_offset]
    t91 = 1.0
    t92 = t90 + t91
    t33.each_with_index do |batch_el_34, batch_i_35|
      out_1 = []
      t36 = batch_el_34["row"] || batch_el_34[:row]
      t93 = batch_el_34["mean"] || batch_el_34[:mean]
      t94 = t93 + t92
      t36.each_with_index do |row_el_37, row_i_38|
        acc_39 = 0.0
        t40 = row_el_37["col"] || row_el_37[:col]
        t86 = row_el_37["scale"] || row_el_37[:scale]
        t88 = t86 * t87
        t40.each_with_index do |col_el_41, col_i_42|
          t69 = col_el_41["val"] || col_el_41[:val]
          t71 = t69 * t88
          t73 = t71 + t94
          acc_39 += t73
        end
        t44 = acc_39
        out_1 << t44
      end
      out << out_1
    end
    out
  end

  def _batch_total_affine(input = @input)
    out = []
    t45 = input["batch"] || input[:batch]
    t110 = input["global_offset"] || input[:global_offset]
    t111 = 1.0
    t101 = 2.0
    t112 = t110 + t111
    t45.each_with_index do |batch_el_46, batch_i_47|
      acc_48 = 0.0
      t49 = batch_el_46["row"] || batch_el_46[:row]
      t105 = batch_el_46["mean"] || batch_el_46[:mean]
      t106 = t105 + t112
      t49.each_with_index do |row_el_50, row_i_51|
        acc77 = 0.0
        t78 = row_el_50["col"] || row_el_50[:col]
        t100 = row_el_50["scale"] || row_el_50[:scale]
        t102 = t100 * t101
        t78.each_with_index do |col_el_41, col_i_42|
          t107 = col_el_41["val"] || col_el_41[:val]
          t108 = t107 * t102
          t109 = t108 + t106
          acc77 += t109
        end
        t80 = acc77
        acc_48 += t80
      end
      t53 = acc_48
      out << t53
    end
    out
  end
end
