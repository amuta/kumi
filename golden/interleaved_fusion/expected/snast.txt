(SNAST
  (VALUE total_payroll
    (Reduce :agg.sum over [employees]
      (InputRef departments.dept.employees.emp.salary key_chain=[salary]) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE payroll_tax
    (Call :core.mul
      (Ref total_payroll) :: [departments] -> integer
      (Const 0.15) :: [] -> float
    ) :: [departments] -> float
  ) :: [departments] -> float
  (VALUE manager_count
    (Reduce :agg.sum over [employees]
      (Select
        (Call :core.eq
          (InputRef departments.dept.employees.emp.role key_chain=[role]) :: [departments, employees] -> string
          (Const "manager") :: [] -> string
        ) :: [departments, employees] -> boolean
        (Const 1) :: [] -> integer
        (Const 0) :: [] -> integer
      ) :: [departments, employees] -> integer
    ) :: [departments] -> integer
  ) :: [departments] -> integer
  (VALUE department_summary
    (Hash
      (Pair name
        (InputRef departments.dept.name key_chain=[name]) :: [departments] -> string
      ) :: [departments] -> pair
      (Pair payroll
        (Ref total_payroll) :: [departments] -> integer
      ) :: [departments] -> pair
      (Pair tax
        (Ref payroll_tax) :: [departments] -> float
      ) :: [departments] -> pair
      (Pair managers
        (Ref manager_count) :: [departments] -> integer
      ) :: [departments] -> pair
    ) :: [departments] -> hash
  ) :: [departments] -> hash
)