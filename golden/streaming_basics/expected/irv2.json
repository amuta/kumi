{
  "version": "0.1",
  "module": "schema_module",
  "declarations": {
    "items_subtotal": {
      "name": "items_subtotal",
      "parameters": [{"kind":"input","path":["items","price"]},{"kind":"input","path":["items","qty"]}],
      "operations": [
        {"id":0,"op":"LoadInput","args":[["items","price"]],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":1,"op":"LoadInput","args":[["items","qty"]],"stamp":{"dtype":"integer","axes":["items"]}},
        {"id":2,"op":"Map","args":[0,1],"stamp":{"dtype":"float","axes":["items"]},"attrs":{"fn":"core.mul"}}
      ],
      "result": 2
    },
    "items_discounted": {
      "name": "items_discounted",
      "parameters": [{"kind":"input","path":["items","price"]},{"kind":"input","path":["discount"]}],
      "operations": [
        {"id":3,"op":"LoadInput","args":[["items","price"]],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":4,"op":"Const","args":[1.0],"stamp":{"dtype":"float","axes":[]}},
        {"id":5,"op":"LoadInput","args":[["discount"]],"stamp":{"dtype":"float","axes":[]}},
        {"id":6,"op":"Map","args":[4,5],"stamp":{"dtype":"float","axes":[]},"attrs":{"fn":"core.sub"}},
        {"id":7,"op":"Map","args":[3,6],"stamp":{"dtype":"float","axes":["items"]},"attrs":{"fn":"core.mul"}}
      ],
      "result": 7
    },
    "items_is_big": {
      "name": "items_is_big",
      "parameters": [{"kind":"input","path":["items","price"]}],
      "operations": [
        {"id":8,"op":"LoadInput","args":[["items","price"]],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":9,"op":"Const","args":[100.0],"stamp":{"dtype":"float","axes":[]}},
        {"id":10,"op":"Map","args":[8,9],"stamp":{"dtype":"boolean","axes":["items"]},"attrs":{"fn":"core.gt"}}
      ],
      "result": 10
    },
    "items_effective": {
      "name": "items_effective",
      "parameters": [{"kind":"dependency","source":"items_is_big"},{"kind":"dependency","source":"items_subtotal"}],
      "operations": [
        {"id":11,"op":"LoadDeclaration","args":["items_is_big"],"stamp":{"dtype":"boolean","axes":["items"]}},
        {"id":12,"op":"LoadDeclaration","args":["items_subtotal"],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":13,"op":"Const","args":[0.9],"stamp":{"dtype":"float","axes":[]}},
        {"id":14,"op":"Map","args":[12,13],"stamp":{"dtype":"float","axes":["items"]},"attrs":{"fn":"core.mul"}},
        {"id":15,"op":"LoadDeclaration","args":["items_subtotal"],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":16,"op":"Select","args":[11,14,15],"stamp":{"dtype":"float","axes":["items"]}}
      ],
      "result": 16
    },
    "total_qty": {
      "name": "total_qty",
      "parameters": [{"kind":"input","path":["items","qty"]}],
      "operations": [
        {"id":17,"op":"LoadInput","args":[["items","qty"]],"stamp":{"dtype":"integer","axes":["items"]}},
        {"id":18,"op":"Reduce","args":[17],"stamp":{"dtype":"integer","axes":[]},"attrs":{"fn":"agg.sum","axis":"items"}}
      ],
      "result": 18
    },
    "cart_total": {
      "name": "cart_total",
      "parameters": [{"kind":"dependency","source":"items_subtotal"}],
      "operations": [
        {"id":19,"op":"LoadDeclaration","args":["items_subtotal"],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":20,"op":"Reduce","args":[19],"stamp":{"dtype":"float","axes":[]},"attrs":{"fn":"agg.sum","axis":"items"}}
      ],
      "result": 20
    },
    "cart_total_effective": {
      "name": "cart_total_effective",
      "parameters": [{"kind":"dependency","source":"items_effective"}],
      "operations": [
        {"id":21,"op":"LoadDeclaration","args":["items_effective"],"stamp":{"dtype":"float","axes":["items"]}},
        {"id":22,"op":"Reduce","args":[21],"stamp":{"dtype":"float","axes":[]},"attrs":{"fn":"agg.sum","axis":"items"}}
      ],
      "result": 22
    }
  },
  "analysis": {
    "defaults": {"key_policy":"indifferent","on_missing":"error"},
    "inputs": [
      {
        "path": ["discount"],
        "axes": [],
        "dtype": "float",
        "key_policy": "indifferent",
        "on_missing": "error",
        "navigation_steps": [],
        "leaf_nav": [{"kind":"field_leaf","key":"discount"}],
        "terminal": {"kind":"none","dtype":"float","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "discount"
      },
      {
        "path": ["items"],
        "axes": ["items"],
        "dtype": "array",
        "key_policy": "indifferent",
        "on_missing": "error",
        "navigation_steps": [{"axes":"items","path":["items"],"loop_idx":0,"kind":"array_field","key":"items"}],
        "leaf_nav": [],
        "terminal": {"kind":"none","dtype":"array","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "items"
      },
      {
        "path": ["items","price"],
        "axes": ["items"],
        "dtype": "float",
        "key_policy": "indifferent",
        "on_missing": "error",
        "navigation_steps": [{"axes":"items","path":["items"],"loop_idx":0,"kind":"array_field","key":"items"}],
        "leaf_nav": [{"kind":"field_leaf","key":"price"}],
        "terminal": {"kind":"none","dtype":"float","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "items.price"
      },
      {
        "path": ["items","qty"],
        "axes": ["items"],
        "dtype": "integer",
        "key_policy": "indifferent",
        "on_missing": "error",
        "navigation_steps": [{"axes":"items","path":["items"],"loop_idx":0,"kind":"array_field","key":"items"}],
        "leaf_nav": [{"kind":"field_leaf","key":"qty"}],
        "terminal": {"kind":"none","dtype":"integer","key_policy":"indifferent","on_missing":"error"},
        "path_fqn": "items.qty"
      }
    ]
  }
}