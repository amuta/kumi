(NAST
  (VALUE items_subtotal
    (Call :multiply
    (InputRef [:items, :item, :price])
    (InputRef [:items, :item, :qty])
  )
  )
  (VALUE items_discounted
    (Call :multiply
    (InputRef [:items, :item, :price])
    (Call :subtract
      (Const 1.0)
      (InputRef [:discount])
    )
  )
  )
  (VALUE items_is_big
    (Call :"core.gt"
    (InputRef [:items, :item, :price])
    (Const 100.0)
  )
  )
  (VALUE items_effective
    (Call :select
    (Ref items_is_big)
    (Call :multiply
      (Ref items_subtotal)
      (Const 0.9)
    )
    (Ref items_subtotal)
  )
  )
  (VALUE total_qty
    (Call :sum
    (InputRef [:items, :item, :qty])
  )
  )
  (VALUE cart_total
    (Call :sum
    (Ref items_subtotal)
  )
  )
  (VALUE cart_total_effective
    (Call :sum
    (Ref items_effective)
  )
  )
)